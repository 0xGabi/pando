!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Pando",[],e):"object"==typeof exports?exports.Pando=e():t.Pando=e()}(global,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=i(n(9)),u=n(30);n(29),e.ipld=function(t,e){return e=e||{},function(n){var r=Reflect.getMetadata("ipld",n)||{};return r[t]=e,Reflect.defineMetadata("ipld",r,n)}};var s=function(){function t(t){this.type=t}return t.prototype.cid=function(){return r(this,void 0,void 0,function(){var t;return o(this,function(e){switch(e.label){case 0:return t=u.promisify(a.default.util.cid),[4,this.toIPLD()];case 1:return[4,t.apply(void 0,[e.sent()])];case 2:return[2,e.sent()]}})})},t.prototype.toIPLD=function(){return r(this,void 0,void 0,function(){var t,e,n,r,i,a,u,s,c,l,f,h,d,p,y,b,v,w,_,m,g,x,P,j,k;return o(this,function(o){switch(o.label){case 0:for(r in(t={})["@type"]=this.type,e=Reflect.getMetadata("ipld",this.constructor.prototype.constructor)||[],n=[],e)n.push(r);i=0,o.label=1;case 1:if(!(i<n.length))return[3,18];if(a=n[i],!e[a].link)return[3,16];switch(u=e[a].type,u){case"map":return[3,2];case"array":return[3,7];case"direct":return[3,12]}return[3,13];case 2:for(c in s=[],this[a])s.push(c);l=0,o.label=3;case 3:return l<s.length?(v=s[l],f=t,h=v,d={},p="/",[4,this[a][v].cid()]):[3,6];case 4:f[h]=(d[p]=o.sent().toBaseEncodedString(),d),o.label=5;case 5:return l++,[3,3];case 6:return[3,15];case 7:t[a]=[],y=0,b=this[a],o.label=8;case 8:return y<b.length?(v=b[y],_=(w=t[a]).push,m={},g="/",[4,v.cid()]):[3,11];case 9:_.apply(w,[(m[g]=o.sent().toBaseEncodedString(),m)]),o.label=10;case 10:return y++,[3,8];case 11:return[3,15];case 12:return t[a]={"/":this[a]},[3,15];case 13:return x=t,P=a,j={},k="/",[4,this[a].cid()];case 14:x[P]=(j[k]=o.sent().toBaseEncodedString(),j),o.label=15;case 15:return[3,17];case 16:t[a]=this[a],o.label=17;case 17:return i++,[3,1];case 18:return[2,t]}})})},t}();e.default=s},function(t,e){t.exports=require("datastore-fs")},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var o=r(n(10));e.fs=o;var i=r(n(41));e.json=i;var a=r(n(39));e.yaml=a},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(3)),a=o(n(2)),u=function(){function t(t,e){this.loom=t,this.name=e,this.head=i.fs.exists(this.path)?this.head:"undefined"}return Object.defineProperty(t.prototype,"path",{get:function(){return a.default.join(this.loom.paths.branches,this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"head",{get:function(){return i.yaml.read(this.path)},set:function(t){i.yaml.write(this.path,t)},enumerable:!0,configurable:!0}),t.new=function(e,n,r){if(t.exists(e,n))throw new Error("Branch "+n+" already exists");return new t(e,n)},t.load=function(e,n,r){if(!t.exists(e,n))throw new Error("Branch "+n+" does not exist");return new t(e,n)},t.exists=function(t,e){return i.fs.exists(a.default.join(t.paths.branches,e))},t.head=function(t,e){return i.yaml.read(a.default.join(t.paths.branches,e))},t}();e.default=u},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},i=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},u=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=s(n(0)),l=n(0),f=function(t){function e(e,n){var r=t.call(this,"file")||this;return r.path=e.path||void 0,r.link=e.link,r}return r(e,t),e.prototype.put=function(t){return a(this,void 0,void 0,function(){var e,n;return u(this,function(r){switch(r.label){case 0:return n=(e=t).put,[4,this.toIPLD()];case 1:return[4,n.apply(e,[r.sent()])];case 2:return[2,r.sent()]}})})},e=o([l.ipld("path"),l.ipld("link",{link:!0,type:"direct"}),i("design:paramtypes",[Object,Object])],e)}(c.default);e.default=f},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},i=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},u=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=s(n(0)),l=n(0),f=function(t){function e(e,n){var r=t.call(this,"tree")||this;return r.path=e.path||void 0,r.children=e.children||{},r}return r(e,t),e.prototype.put=function(t){return a(this,void 0,void 0,function(){var e,n,r,o,i,a,s;return u(this,function(u){switch(u.label){case 0:return r=(n=t).put,[4,this.toIPLD()];case 1:return[4,r.apply(n,[u.sent()])];case 2:for(i in e=u.sent(),o=[],this.children)o.push(i);a=0,u.label=3;case 3:return a<o.length?(s=o[a],[4,this.children[s].put(t)]):[3,6];case 4:u.sent(),u.label=5;case 5:return a++,[3,3];case 6:return[2,e]}})})},e.get=function(t,e){return a(this,void 0,void 0,function(){return u(this,function(n){switch(n.label){case 0:return[4,t.get(e,"tree")];case 1:return[2,n.sent()]}})})},e=o([l.ipld("path"),l.ipld("children",{link:!0,type:"map"}),i("design:paramtypes",[Object,Object])],e)}(c.default);e.default=f},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},i=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=a(n(0)),s=n(0),c=function(t){function e(e,n){var r=t.call(this,"snapshot")||this;return r.author=e.author,r.tree=e.tree,r.parents=e.parents||[],r.message=e.message,r.timestamp=e.timestamp||Date.now(),r}return r(e,t),e=o([s.ipld("timestamp"),s.ipld("author"),s.ipld("message"),s.ipld("parents",{link:!0,type:"array"}),s.ipld("tree",{link:!0}),i("design:paramtypes",[Object,Object])],e)}(u.default);e.default=c},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=i(n(3)),s=a(n(2)),c=a(n(31)),l=function(){function t(t){this.loom=t}return Object.defineProperty(t.prototype,"path",{get:function(){return this.loom.paths.index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"current",{get:function(){return u.yaml.read(this.path)},set:function(t){u.yaml.write(this.path,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unsnapshot",{get:function(){var t=this.current,e=[];for(var n in t)t[n].repo!==t[n].stage&&e.push(n);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"staged",{get:function(){var t=this.current,e=[];for(var n in t)"null"!==t[n].stage&&e.push(n);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"modified",{get:function(){var t=this.current,e=[];for(var n in t)"null"!==t[n].stage&&t[n].wdir!==t[n].stage&&e.push(n);return e},enumerable:!0,configurable:!0}),t.new=function(e){return r(this,void 0,void 0,function(){return o(this,function(n){return[2,new t(e)]})})},t.load=function(e){return r(this,void 0,void 0,function(){return o(this,function(n){return[2,new t(e)]})})},t.prototype.reinitialize=function(t,e){return r(this,void 0,void 0,function(){var n,r,i,a,u,s,c;return o(this,function(o){switch(o.label){case 0:for(i in n=e||{},delete t["@type"],delete t.path,r=[],t)r.push(i);a=0,o.label=1;case 1:return a<r.length?(u=r[a],[4,this.loom.node.get(t[u]["/"])]):[3,6];case 2:return"tree"!==(s=o.sent())["@type"]?[3,4]:[4,this.reinitialize(s,n)];case 3:return o.sent(),[3,5];case 4:"file"===s["@type"]&&(c=s.link["/"],n[s.path]={mtime:new Date(Date.now()),wdir:c,stage:c,repo:c}),o.label=5;case 5:return a++,[3,1];case 6:return this.current=n,[2]}})})},t.prototype.update=function(){return r(this,void 0,void 0,function(){var t,e,n,r,i,a,u,l,f,h,d,p,y,b,v;return o(this,function(o){switch(o.label){case 0:for(i in t=this.current,e={},n=function(t){return t.path.indexOf(".pando")<0},r=c.default(this.loom.paths.root,{nodir:!0,filter:n}))b=s.default.relative(this.loom.paths.root,r[i].path),a=r[i].stats.mtime,e[b]={mtime:new Date(a)};for(f in u=Object.assign(e),l=[],t)l.push(f);h=0,o.label=1;case 1:return h<l.length?(b=l[h],e[b]?new Date(t[b].mtime)<=new Date(e[b].mtime)?[4,this.loom.node.cid(s.default.join(this.loom.paths.root,b),{file:!0})]:[3,3]:[3,4]):[3,7];case 2:v=o.sent(),t[b].mtime=e[b].mtime,t[b].wdir=v,o.label=3;case 3:return[3,5];case 4:t[b].mtime=new Date(Date.now()),t[b].wdir="null",o.label=5;case 5:delete u[b],o.label=6;case 6:return h++,[3,1];case 7:for(p in d=[],u)d.push(p);y=0,o.label=8;case 8:return y<d.length?(b=d[y],[4,this.loom.node.cid(s.default.join(this.loom.paths.root,b),{file:!0})]):[3,11];case 9:v=o.sent(),t[b]={mtime:e[b].mtime,wdir:v,stage:"null",repo:"null"},o.label=10;case 10:return y++,[3,8];case 11:return this.current=t,[2,t]}})})},t.prototype.stage=function(t){return r(this,void 0,void 0,function(){var e,n,r,i,a,c;return o(this,function(o){switch(o.label){case 0:return[4,this.update()];case 1:e=o.sent(),n=0,r=t,o.label=2;case 2:return n<r.length?(i=r[n],i=s.default.normalize(i),a=s.default.relative(this.loom.paths.root,i),u.fs.exists(i)?[4,this.loom.node.upload(i)]:[3,4]):[3,6];case 3:return c=o.sent(),e[a].stage=c,[3,5];case 4:if("null"!==e[a].wdir)throw new Error(i+" does not exist in current working directory");delete e[a],o.label=5;case 5:return n++,[3,2];case 6:return this.current=e,[2,e]}})})},t}();e.default=l},function(t,e){t.exports=require("ipld-pando")},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(43)),a=o(n(42));e.mkdir=function(t){return i.mkdirSync(t)},e.exists=function(t){return i.existsSync(t)},e.write=function(t,e){return i.writeFileSync(t,e)},e.read=function(t){return i.readFileSync(t)},e.rm=function(t){return a.default.sync(t)}},function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},u=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var s=a(n(12)),c=a(n(44)),l=a(n(8)),f=a(n(4)),h=a(n(7)),d=a(n(6)),p=a(n(5)),y=a(n(28)),b=a(n(27)),v=u(n(3)),w=a(n(2)),_=function(){function t(e,n,o){for(var i in void 0===n&&(n="."),this.branch=new y.default(this),this.remote=new b.default(this),this.paths=r({},t.paths),this.paths)this.paths[i]=w.default.join(n,this.paths[i]);this.pando=e}return Object.defineProperty(t.prototype,"currentBranchName",{get:function(){return v.yaml.read(this.paths.current)},set:function(t){v.yaml.write(this.paths.current,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentBranch",{get:function(){return f.default.load(this,this.currentBranchName)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"head",{get:function(){return this.currentBranch.head},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return v.yaml.read(this.paths.config)},set:function(t){v.yaml.write(this.paths.config,t)},enumerable:!0,configurable:!0}),t.new=function(e,n,r){return void 0===n&&(n="."),o(this,void 0,void 0,function(){var r,o,a;return i(this,function(i){switch(i.label){case 0:return r=new t(e,n),[4,v.fs.mkdir(r.paths.pando)];case 1:return i.sent(),[4,v.fs.mkdir(r.paths.ipfs)];case 2:return i.sent(),[4,v.fs.mkdir(r.paths.branches)];case 3:return i.sent(),[4,v.fs.mkdir(r.paths.remotes)];case 4:return i.sent(),[4,v.yaml.write(r.paths.index,{})];case 5:return i.sent(),[4,v.yaml.write(r.paths.config,e.configuration)];case 6:return i.sent(),[4,f.default.new(r,"master")];case 7:return i.sent(),[4,v.yaml.write(r.paths.current,"master")];case 8:return i.sent(),o=r,[4,c.default.new(r)];case 9:return o.node=i.sent(),a=r,[4,l.default.new(r)];case 10:return a.index=i.sent(),[2,r]}})})},t.load=function(e,n){return void 0===e&&(e="."),o(this,void 0,void 0,function(){var n,r,o,a;return i(this,function(i){switch(i.label){case 0:if(!t.exists(e))throw new Error("No pando loom found at "+e);return n=new s.default(v.yaml.read(w.default.join(e,t.paths.config))),r=new t(n,e),o=r,[4,c.default.load(r)];case 1:return o.node=i.sent(),a=r,[4,l.default.load(r)];case 2:return a.index=i.sent(),[2,r]}})})},t.exists=function(e){for(var n in void 0===e&&(e="."),t.paths){var r=w.default.join(e,t.paths[n]);if(!v.fs.exists(r))return!1}return!0},t.prototype.stage=function(t){return o(this,void 0,void 0,function(){return i(this,function(e){return[2,this.index.stage(t)]})})},t.prototype.snapshot=function(t){return o(this,void 0,void 0,function(){var e,n,r,o,a,u,s,c;return i(this,function(i){switch(i.label){case 0:return[4,this.index.update()];case 1:if(i.sent(),!this.index.unsnapshot.length)throw new Error("Nothing to snapshot");return[4,this.tree()];case 2:return[4,(e=i.sent()).put(this.node)];case 3:return i.sent(),"undefined"===this.head?[3,6]:(o=this.fromIPLD,[4,this.node.get(this.head)]);case 4:return[4,o.apply(this,[i.sent()])];case 5:return r=[i.sent()],[3,7];case 6:r=void 0,i.label=7;case 7:return n=r,a=new h.default({author:this.pando.configuration.author,tree:e,parents:n,message:t}),c=(s=this.node).put,[4,a.toIPLD()];case 8:return[4,c.apply(s,[i.sent()])];case 9:return u=i.sent(),this.currentBranch.head=u.toBaseEncodedString(),[2,a]}})})},t.prototype.checkout=function(t){return o(this,void 0,void 0,function(){var e,n,r,o,a,u;return i(this,function(i){switch(i.label){case 0:return[4,this.index.update()];case 1:if(i.sent(),!f.default.exists(this,t))throw new Error("Branch "+t+" does not exist");if(this.index.unsnapshot.length)throw new Error("You have unsnapshot modifications: "+this.index.unsnapshot);if(this.index.modified.length)throw new Error("You have unstaged and unsnaphot modifications: "+this.index.modified);return e=f.default.head(this,t),n=this.head,"undefined"===e?[3,8]:(r=void 0,o=void 0,[4,this.node.get(e,"tree")]);case 2:return o=i.sent(),"undefined"===n?[3,4]:[4,this.node.get(n,"tree")];case 3:return r=i.sent(),[3,5];case 4:r=new d.default({path:".",children:[]}).toIPLD(),i.label=5;case 5:return[4,this.updateWorkingDirectory(r,o)];case 6:return i.sent(),[4,this.index.reinitialize(o)];case 7:return i.sent(),[3,11];case 8:return u=(a=this.index).reinitialize,[4,new d.default({path:".",children:[]}).toIPLD()];case 9:return[4,u.apply(a,[i.sent()])];case 10:i.sent(),i.label=11;case 11:return this.currentBranchName=t,[2]}})})},t.prototype.fromIPLD=function(t){return o(this,void 0,void 0,function(){var e,n,r,o,a,u,s,c,l,f,y,b,v,w,_,m,g,x,P,j,k,O,M;return i(this,function(i){switch(i.label){case 0:switch(e={},n={},t["@type"]){case"snapshot":e=Reflect.getMetadata("ipld",h.default.prototype.constructor);break;case"tree":e=Reflect.getMetadata("ipld",d.default.prototype.constructor);break;case"file":e=Reflect.getMetadata("ipld",p.default.prototype.constructor);break;default:throw new TypeError("Unrecognized IPLD node.")}for(a in o=[],e)o.push(a);u=0,i.label=1;case 1:if(!(u<o.length))return[3,21];if(s=o[u],!e[s].link)return[3,19];switch(c=e[s].type,c){case"map":return[3,2];case"array":return[3,8];case"direct":return[3,14]}return[3,15];case 2:for(f in n.children={},l=[],t)l.push(f);y=0,i.label=3;case 3:return y<l.length?"@type"===(g=l[y])||"path"===g?[3,6]:(b=n.children,v=g,w=this.fromIPLD,[4,this.node.get(t[g]["/"])]):[3,7];case 4:return[4,w.apply(this,[i.sent()])];case 5:b[v]=i.sent(),i.label=6;case 6:return y++,[3,3];case 7:return[3,18];case 8:n[s]=[],_=0,m=t[s],i.label=9;case 9:return _<m.length?(g=m[_],P=(x=n[s]).push,j=this.fromIPLD,[4,this.node.get(t[s][g]["/"])]):[3,13];case 10:return[4,j.apply(this,[i.sent()])];case 11:P.apply(x,[i.sent()]),i.label=12;case 12:return _++,[3,9];case 13:return[3,18];case 14:return n[s]=t[s]["/"],[3,18];case 15:return k=n,O=s,M=this.fromIPLD,[4,this.node.get(t[s]["/"])];case 16:return[4,M.apply(this,[i.sent()])];case 17:k[O]=i.sent(),i.label=18;case 18:return[3,20];case 19:n[s]=t[s],i.label=20;case 20:return u++,[3,1];case 21:switch(t["@type"]){case"snapshot":r=new h.default(n);break;case"tree":r=new d.default(n);break;case"file":r=new p.default(n);break;default:throw new TypeError("Unrecognized IPLD node.")}return[2,r]}})})},t.prototype.tree=function(){for(var t=this.index.current,e=this.index.staged,n=new d.default({path:"."}),r=0,o=e;r<o.length;r++){o[r].split(w.default.sep).reduce(function(e,n){var r=w.default.join(e.path,n);return e.children[n]||(t[r]?(e.children[n]=new p.default({path:r,link:t[r].stage}),t[r].repo=t[r].stage):e.children[n]=new d.default({path:r})),e.children[n]},n)}return this.index.current=t,n},t.prototype.updateWorkingDirectory=function(t,e){return o(this,void 0,void 0,function(){var n,r,o,a,u,s,c,l,f,h,d,p;return i(this,function(i){switch(i.label){case 0:for(r in delete t["@type"],delete t.path,delete e["@type"],delete e.path,n=[],e)n.push(r);o=0,i.label=1;case 1:return o<n.length?(d=n[o],t[d]?[3,3]:[4,this.node.download(e[d]["/"])]):[3,15];case 2:return i.sent(),delete t[d],[3,14];case 3:return t[d]["/"]===e[d]["/"]?[3,13]:[4,this.node.get(t[d]["/"],"@type")];case 4:return a=i.sent(),[4,this.node.get(e[d]["/"],"@type")];case 5:return u=i.sent(),a===u?[3,7]:[4,this.node.download(e[d]["/"])];case 6:return i.sent(),[3,13];case 7:return"file"!==a?[3,9]:[4,this.node.download(e[d]["/"])];case 8:return i.sent(),[3,13];case 9:return"tree"!==a?[3,13]:[4,this.node.get(t[d]["/"])];case 10:return s=i.sent(),[4,this.node.get(e[d]["/"])];case 11:return c=i.sent(),[4,this.updateWorkingDirectory(s,c)];case 12:i.sent(),i.label=13;case 13:delete t[d],i.label=14;case 14:return o++,[3,1];case 15:for(f in l=[],t)l.push(f);h=0,i.label=16;case 16:return h<l.length?(d=l[h],[4,this.node.get(t[d]["/"],"path")]):[3,19];case 17:p=i.sent(),v.fs.rm(w.default.join(this.paths.root,p)),i.label=18;case 18:return h++,[3,16];case 19:return[2]}})})},t.paths={root:".",pando:".pando",ipfs:".pando/ipfs",index:".pando/index",current:".pando/current",config:".pando/config",branches:".pando/branches",remotes:".pando/remotes"},t}();e.default=_},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(45)),a=o(n(25)),u=o(n(18)),s=r(n(7));e.Snapshot=s.default;var c=r(n(6));e.Tree=c.default;var l=r(n(5));e.File=l.default;var f=r(n(0));e.IPLDNode=f.default;var h=r(n(11));e.Loom=h.default;var d=r(n(8));e.Index=d.default;var p=r(n(4));e.Branch=p.default;var y=function(){function t(e){this.loom=new i.default(this),this.configuration=e,this.web3=t.utils.web3.get(e.ethereum),this.contracts=t.contracts.initialize(this.web3,e.author.account)}return t.contracts=a,t.utils=u,t}();e.default=y},function(t,e){t.exports=require("js-sha3")},function(t,e){t.exports=require("eth-ens-namehash")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),o=n(13);e.APP_BASE_NAMESPACE="0x"+o.keccak256("base"),e.namehash=function(t){return r.hash(t)}},function(t,e){t.exports=require("web3")},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(n(16));e.get=function(t){var e;return t.gateway&&"function"!=typeof(e=new o.default(new o.default.providers.HttpProvider(t.gateway))).currentProvider.sendAsync&&(e.currentProvider.sendAsync=function(){return e.currentProvider.send.apply(e.currentProvider,arguments)}),e}},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var o=r(n(17));e.web3=o;var i=r(n(15));e.aragon=i},function(t,e){t.exports=require("@ryhope/pando-core/build/contracts/Tree.json")},function(t,e){t.exports=require("@aragon/os/build/contracts/AppProxyUpgradeable.json")},function(t,e){t.exports=require("@aragon/os/build/contracts/ACL.json")},function(t,e){t.exports=require("@aragon/os/build/contracts/DAOFactory.json")},function(t,e){t.exports=require("@aragon/os/build/contracts/Kernel.json")},function(t,e){t.exports=require("truffle-contract")},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(n(24));e.artifacts={kernel:n(23),daoFactory:n(22),acl:n(21),appProxyUpgradeable:n(20),appProxyFactory:n(46),tree:n(19)},e.kernel=o.default(e.artifacts.kernel),e.daoFactory=o.default(e.artifacts.daoFactory),e.acl=o.default(e.artifacts.acl),e.tree=o.default(e.artifacts.tree),e.appProxyUpgradeable=o.default(e.artifacts.appProxyUpgradeable),e.appProxyFactory=o.default(e.artifacts.appProxyFactory),e.initialize=function(t,n){var r={};for(var i in e.artifacts)r[i]=o.default(e.artifacts[i]),r[i].setProvider(t.currentProvider),r[i].defaults({from:n,gas:1e8});return r}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(13),a=n(14),u=function(){function t(t,e,n,r,o){this.loom=t,this.name=o,this.hash="0x"+i.keccak256(o),this.kernel=e,this.acl=n,this.tree=r}return t.deploy=function(e,n){return r(this,void 0,void 0,function(){var r,i,a,u,s,c,l,f,h,d,p,y,b,v;return o(this,function(o){switch(o.label){case 0:return[4,e.pando.contracts.kernel.new()];case 1:return r=o.sent(),[4,e.pando.contracts.acl.new()];case 2:return i=o.sent(),[4,e.pando.contracts.daoFactory.new(r.address,i.address,"0x00")];case 3:return[4,o.sent().newDAO(e.config.author.account)];case 4:return a=o.sent(),u=a.logs.filter(function(t){return"DeployDAO"===t.event})[0].args.dao,[4,e.pando.contracts.kernel.at(u)];case 5:return s=o.sent(),f=(l=e.pando.contracts.acl).at,[4,s.acl()];case 6:return[4,f.apply(l,[o.sent()])];case 7:return c=o.sent(),[4,s.APP_MANAGER_ROLE()];case 8:return h=o.sent(),[4,c.createPermission(e.config.author.account,s.address,h,e.config.author.account)];case 9:return o.sent(),[4,e.pando.contracts.tree.new()];case 10:return d=o.sent(),[4,s.newAppInstance(t.TREE_APP_ID,d.address)];case 11:return p=o.sent(),y=p.logs.filter(function(t){return"NewAppProxy"===t.event})[0].args.proxy,[4,e.pando.contracts.tree.at(y)];case 12:return[4,(b=o.sent()).PUSH()];case 13:return v=o.sent(),[4,c.createPermission(e.config.author.account,b.address,v,e.config.author.account)];case 14:return o.sent(),[2,new t(e,s,c,b,n)]}})})},t.at=function(e,n,i,a,u){return r(this,void 0,void 0,function(){var r,s,c;return o(this,function(o){switch(o.label){case 0:return[4,e.pando.contracts.kernel.at(n)];case 1:return r=o.sent(),[4,e.pando.contracts.kernel.at(i)];case 2:return s=o.sent(),[4,e.pando.contracts.kernel.at(a)];case 3:return c=o.sent(),[2,new t(e,r,s,c,u)]}})})},t.TREE_APP_ID=a.hash("tree.pando.aragonpm.test"),t}();e.default=u},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var u=i(n(26)),s=a(n(3)),c=i(n(2)),l=function(){function t(t){this.loom=t}return t.prototype.deploy=function(t){return r(this,void 0,void 0,function(){var e;return o(this,function(n){switch(n.label){case 0:return[4,u.default.deploy(this.loom,t)];case 1:return e=n.sent(),this.save(t,e),[2,e]}})})},t.prototype.at=function(t){return r(this,void 0,void 0,function(){var e;return o(this,function(n){switch(n.label){case 0:return e=this.load(t),[4,u.default.at(this.loom,e.kernel,e.acl,e.tree,t)];case 1:return[2,n.sent()]}})})},t.prototype.save=function(t,e){var n={kernel:e.kernel.address,acl:e.acl.address,tree:e.tree.address};return s.yaml.write(c.default.join(this.loom.paths.remotes,t),n),n},t.prototype.load=function(t){return s.yaml.read(c.default.join(this.loom.paths.remotes,t))},t}();e.default=l},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=i(n(4)),u=function(){function t(t){this.loom=t}return t.prototype.new=function(t,e){return r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,a.default.new(this.loom,t)];case 1:return[2,e.sent()]}})})},t}();e.default=u},function(t,e){t.exports=require("reflect-metadata")},function(t,e){t.exports=require("util")},function(t,e){t.exports=require("klaw-sync")},function(t,e){t.exports=require("promisify-event")},function(t,e){t.exports=require("cids")},function(t,e){t.exports=require("ipld")},function(t,e){t.exports=require("ipfs-repo/src/lock-memory")},function(t,e){t.exports=require("ipfs-repo")},function(t,e){t.exports=require("ipfs")},function(t,e){t.exports=require("js-yaml")},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(10)),a=o(n(38));e.read=function(t){return a.default.safeLoad(i.read(t))},e.write=function(t,e,n){return i.write(t,a.default.safeDump(e,n))}},function(t,e){t.exports=require("jsonfile")},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var o=r(n(40));e.write=function(t,e){return o.writeFileSync(t,e)},e.read=function(t){return o.readFileSync(t)}},function(t,e){t.exports=require("rimraf")},function(t,e){t.exports=require("fs")},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=i(n(3)),s=a(n(37)),c=a(n(36)),l=a(n(35)),f=a(n(34)),h=a(n(9)),d=a(n(33)),p=a(n(32)),y=a(n(2)),b={storageBackends:{root:n(1),blocks:n(1),keys:n(1),datastore:n(1)},storageBackendOptions:{root:{extension:".ipfsroot",errorIfExists:!1,createIfMissing:!0},blocks:{sharding:!1,extension:".ipfsblock",errorIfExists:!1,createIfMissing:!0},keys:{extension:".ipfskey",errorIfExists:!1,createIfMissing:!0},datastore:{extension:".ipfsds",errorIfExists:!1,createIfMissing:!0}},lock:l.default},v=function(){function t(t,e,n){this.loom=t,this.ipfs=e,this.ipld=n}return t.new=function(e){return r(this,void 0,void 0,function(){var n,r,i;return o(this,function(o){switch(o.label){case 0:return n=new c.default(e.paths.ipfs,b),r=new s.default({repo:n,start:!1}),[4,p.default(r,"ready")];case 1:return o.sent(),(i=new f.default(r.block)).support.rm("raw"),i.support.add("raw",h.default.resolver,h.default.util),[2,new t(e,r,i)]}})})},t.load=function(e){return r(this,void 0,void 0,function(){var n,r,i;return o(this,function(o){switch(o.label){case 0:return n=new c.default(e.paths.ipfs,b),r=new s.default({repo:n,init:!1,start:!1}),[4,p.default(r,"ready")];case 1:return o.sent(),(i=new f.default(r.block)).support.rm("raw"),i.support.add("raw",h.default.resolver,h.default.util),[2,new t(e,r,i)]}})})},t.prototype.upload=function(t){return r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.ipfs.files.add([{path:y.default.relative(this.loom.paths.root,t),content:u.fs.read(t)}])];case 1:return[2,e.sent()[0].hash]}})})},t.prototype.download=function(t,e){return r(this,void 0,void 0,function(){var e=this;return o(this,function(n){return[2,new Promise(function(n,i){return r(e,void 0,void 0,function(){var e,a=this;return o(this,function(s){return e=d.default.isCID(t)?t:new d.default(t),this.ipld.get(e,function(t,e){return r(a,void 0,void 0,function(){var r,a,s,c;return o(this,function(o){switch(o.label){case 0:return t?(i(t),[3,5]):[3,1];case 1:if(r=e.value,a=y.default.join(this.loom.paths.root,r.path),"tree"!==r["@type"])return[3,2];for(s in u.fs.exists(a)||u.fs.mkdir(a),delete r["@type"],delete r.path,r)this.download(r[s]["/"]);return[3,4];case 2:return"file"!==r["@type"]?[3,4]:[4,this.ipfs.files.cat(r.link["/"])];case 3:c=o.sent(),u.fs.write(a,c),o.label=4;case 4:n(!0),o.label=5;case 5:return[2]}})})}),[2]})})})]})})},t.prototype.put=function(t){return r(this,void 0,void 0,function(){var e=this;return o(this,function(n){return[2,new Promise(function(n,i){return r(e,void 0,void 0,function(){var e=this;return o(this,function(a){return this.ipld.put(t,{format:"raw",hashAlg:"keccak-256"},function(t,a){return r(e,void 0,void 0,function(){return o(this,function(e){return t?i(t):n(a),[2]})})}),[2]})})})]})})},t.prototype.get=function(t,e){return r(this,void 0,void 0,function(){var n=this;return o(this,function(i){return[2,new Promise(function(i,a){return r(n,void 0,void 0,function(){var n,u=this;return o(this,function(s){return n=d.default.isCID(t)?t:new d.default(t),this.ipld.get(n,e||"",function(t,e){return r(u,void 0,void 0,function(){return o(this,function(n){return t?a(t):i(e.value),[2]})})}),[2]})})})]})})},t.prototype.cid=function(t,e){return r(this,void 0,void 0,function(){var n;return o(this,function(r){switch(r.label){case 0:return e.file?(n=[{path:y.default.relative(this.loom.paths.root,t),content:u.fs.read(t)}],[4,this.ipfs.files.add(n,{"only-hash":!0})]):[3,2];case 1:return[2,r.sent()[0].hash];case 2:return[2]}})})},t}();e.default=v},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=i(n(11)),u=function(){function t(t){this.pando=t}return t.prototype.new=function(t){return void 0===t&&(t="."),r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,a.default.new(this.pando,t)];case 1:return[2,e.sent()]}})})},t.prototype.load=function(t){return void 0===t&&(t="."),r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,a.default.load(t)];case 1:return[2,e.sent()]}})})},t}();e.default=u},function(t,e){t.exports=require("@aragon/os/build/contracts/AppProxyFactory.json")}])});